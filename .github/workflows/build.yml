name: Build and Publish CFnat-Windows-GUI

on:
  push:
    branches:
      - master  # 触发主分支的推送事件
  pull_request:
    branches:
      - master  # 触发主分支的 PR 事件
  workflow_dispatch:  # 允许手动触发工作流

jobs:
  build:
    runs-on: windows-latest  # 使用 Windows 环境构建

    steps:
    - name: Checkout code
      uses: actions/checkout@v3  # 检出当前代码

    - name: Install Visual Studio Build Tools
      run: |
        # 安装 Visual Studio Build Tools，以确保 MSBuild 工具可用
        choco install visualstudio2019buildtools --version 16.11.3

    - name: Add MSBuild to PATH
      run: |
        # 将 MSBuild 添加到环境变量中（如果它没有被自动添加）
        echo "##[add-path]C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\BuildTools\\MSBuild\\Current\\Bin" >> $GITHUB_ENV

    - name: Restore NuGet packages
      run: |
        nuget restore cfnat.win.gui.sln  # 恢复 NuGet 包

    - name: Build the project
      run: |
        msbuild cfnat.win.gui.csproj /p:Configuration=Release /p:Platform=x64  # 使用 MSBuild 编译项目

    - name: Upload build artifacts
      uses: actions/upload-artifact@v3
      with:
        name: cfnat-windows-gui
        path: ./bin/Release  # 将构建结果上传为构建工件
